<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - CampusCore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="../assets/icons/favicon.ico">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Basic styles */
        .loading-spinner { border: 4px solid #f3f4f6; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        .loading-overlay { /* ... */ }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div id="loading" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
    </div>

    <div class="bg-white p-8 sm:p-12 rounded-lg shadow-xl text-center max-w-lg mx-auto border border-gray-200">
        <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-green-100 mb-6">
            <svg class="h-10 w-10 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
            </svg>
        </div>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-3">Thank You for Your Purchase!</h1>
        <p class="text-gray-600 mb-6">Your order has been placed successfully.</p>
        <div class="bg-gray-50 p-4 rounded-md border border-gray-200 mb-6">
            <p class="text-sm text-gray-500">Your Order ID:</p>
            <p id="order-id" class="text-lg font-medium text-gray-800 break-all">Loading...</p>
            <p id="payment-method-info" class="text-sm text-gray-500 mt-2"></p>
        </div>
        <p class="text-sm text-gray-500 mb-6">You will receive updates regarding pickup shortly.</p>
        <p class="text-sm text-gray-500 mb-6">You can now visit the Tangkiran Mart and get you order now!!</p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href="marketplace.html" class="inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-5 py-2.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50">
                Continue Shopping
            </a>
            <a href="dashboard.html" class="inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700">
                Go to Dashboard
            </a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="../js/config/firebase.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadingOverlay = document.getElementById('loading');
            loadingOverlay.classList.remove('hidden'); // Show loading

            firebase.auth().onAuthStateChanged(user => {
                if (!user) {
                    window.location.href = '../login.html'; // Redirect if not logged in
                    return;
                }

                // Get Order ID and Payment Method from URL
                const urlParams = new URLSearchParams(window.location.search);
                const orderId = urlParams.get('orderId');
                const paymentMethod = urlParams.get('paymentMethod'); // Get payment method

                const orderIdElement = document.getElementById('order-id');
                const paymentInfoElement = document.getElementById('payment-method-info');

                if (orderId && orderIdElement) {
                    orderIdElement.textContent = orderId;
                } else if (orderIdElement) {
                    orderIdElement.textContent = 'N/A';
                    console.error("Order ID not found in URL parameters.");
                }

                // Display payment method info
                if (paymentMethod && paymentInfoElement) {
                     if (paymentMethod === 'cod') {
                         paymentInfoElement.textContent = 'Payment Method: Cash on Pickup';
                     } else if (paymentMethod === 'card') { // If you implement card later
                          paymentInfoElement.textContent = 'Payment Method: Card (Paid)';
                     } else {
                         paymentInfoElement.textContent = `Payment Method: ${paymentMethod}`;
                     }
                }

                // Optional: Fetch order details from Firebase to display more info
                // if (orderId) {
                //     firebase.database().ref(`orders/${orderId}`).once('value')
                //         .then(snapshot => {
                //             if (snapshot.exists()) {
                //                 const orderData = snapshot.val();
                //                 // Display order total, items, etc.
                //                 console.log("Order Data:", orderData);
                //             } else {
                //                 console.warn("Could not find order details for ID:", orderId);
                //             }
                //         })
                //         .catch(error => {
                //             console.error("Error fetching order details:", error);
                //         })
                //         .finally(() => {
                //             loadingOverlay.classList.add('hidden'); // Hide loading after fetch
                //         });
                // } else {
                    loadingOverlay.classList.add('hidden'); // Hide loading if no ID
                // }
                 loadingOverlay.classList.add('hidden'); // Hide loading immediately if not fetching details

            });
        });
    </script>
</body>
</html>